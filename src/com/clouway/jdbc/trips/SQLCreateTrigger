// Create function for search a user in articleHistory table by id

delimiter $
CREATE FUNCTION searchForPerson(id_number INT)
RETURNS INT
READS SQL DATA BEGIN
RETURN (SELECT COUNT(*) FROM personUpdates WHERE personUpdates.id = id_number);
END$
delimiter ;

// Create trigger that saves a copy of data into articleHistory table, when an update occurs in article table

delimiter $
CREATE TRIGGER saveToPersonUpdates BEFORE UPDATE ON person
FOR EACH ROW BEGIN
IF (SELECT searchForPerson(OLD.id) = 0)
THEN INSERT INTO personUpdates VALUES(OLD.name, OLD.id, OLD.age, OLD.email);
ELSE UPDATE personUpdates SET email = OLD.email WHERE personUpdates.id = OLD.id;
END IF;
END$
delimiter ;
